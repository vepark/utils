#!/bin/bash

# Directory to search
SEARCH_DIR="/path/to/search/root"

# Output CSV file
OUTPUT_FILE="/path/to/output/files_list.csv"

# Prepare or clear the output file
echo "REDFolderName,INPUTsubfolderFileNames" > "$OUTPUT_FILE"

# Find directories starting with 'RED' that contain an 'INPUT' subdirectory
find "$SEARCH_DIR" -type d -name 'RED*' | while read -r red_folder; do
  if [ -d "$red_folder/INPUT" ]; then
    # Capture the RED folder name
    red_folder_name=$(basename "$red_folder")

    # List files inside the 'INPUT' subfolder and concatenate them into one line
    input_files=$(find "$red_folder/INPUT" -type f -exec basename {} \; | tr '\n' ',' | sed 's/,$//')

    # Write to the CSV file
    echo "$red_folder_name,\"$input_files\"" >> "$OUTPUT_FILE"
  fi
done




chmod +x list_files.sh
./list_files.sh


/* Import the CSV file created by the shell script */
proc import datafile="/path/to/output/files_list.csv"
    out=want
    dbms=csv
    replace;
    getnames=yes;
run;

/* Display the dataset */
proc print data=want;
run;









* Ensure noxcmd is not set if running in a restricted environment;
options xcmd;

* File path for the output CSV;
%let output_csv = /path/to/output/files_list.csv;

* Directory to start the search;
%let start_dir = /path/to/search/root;

* Clear the output file to avoid appending to old results;
x "echo 'REDFolderName,INPUTsubfolderFileNames' > &output_csv.";

* Construct and execute the shell command to list the files;
x "find &start_dir. -type d -name 'RED*' | while read -r red_folder; do \
    if [ -d ""$red_folder/INPUT"" ]; then \
        red_folder_name=$(basename ""$red_folder""); \
        input_files=$(find ""$red_folder/INPUT"" -type f -exec basename {} \; | tr '\n' ',' | sed 's/,$//'); \
        echo ""$red_folder_name,\"$input_files\""" >> &output_csv.; \
    fi; \
done";

* Import the resulting CSV into a SAS dataset;
proc import datafile="&output_csv."
    out=want
    dbms=csv
    replace;
    getnames=yes;
run;

* Display the dataset;
proc print data=want;
    title "List of Files in INPUT Directories Under RED Folders";
run;
