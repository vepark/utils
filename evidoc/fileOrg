#!/bin/bash

# Define the root directory to search
SEARCH_DIR="/path/to/search/root"

# Define the output CSV file path
OUTPUT_CSV="/path/to/output/files_list.csv"

# Write the CSV header
echo "REDFolderName,INPUTsubfolderFileNames" > "$OUTPUT_CSV"

# Find all directories starting with RED and containing an INPUT folder
find "$SEARCH_DIR" -type d -name 'RED*' | while read -r red_folder; do
  if [ -d "$red_folder/INPUT" ]; then
    # Extract just the name of the RED folder
    red_folder_name=$(basename "$red_folder")

    # List all files in the INPUT subfolder, join with commas, avoid directories
    input_files=$(find "$red_folder/INPUT" -type f -exec basename {} \; | tr '\n' ',' | sed 's/,$//')

    # Only write to CSV if there are actual files
    if [ ! -z "$input_files" ]; then
      echo "$red_folder_name,\"$input_files\"" >> "$OUTPUT_CSV"
    fi
  fi
done





chmod +x list_files.sh
./list_files.sh


/* Import the CSV file created by the shell script */
proc import datafile="/path/to/output/files_list.csv"
    out=want
    dbms=csv
    replace;
    getnames=yes;
run;

/* Display the dataset */
proc print data=want;
run;









* Ensure noxcmd is not set if running in a restricted environment;
options xcmd;

* File path for the output CSV;
%let output_csv = /path/to/output/files_list.csv;

* Directory to start the search;
%let start_dir = /path/to/search/root;

* Clear the output file to avoid appending to old results;
x "echo 'REDFolderName,INPUTsubfolderFileNames' > &output_csv.";

* Construct and execute the shell command to list the files;
x "find &start_dir. -type d -name 'RED*' | while read -r red_folder; do \
    if [ -d ""$red_folder/INPUT"" ]; then \
        red_folder_name=$(basename ""$red_folder""); \
        input_files=$(find ""$red_folder/INPUT"" -type f -exec basename {} \; | tr '\n' ',' | sed 's/,$//'); \
        echo ""$red_folder_name,\"$input_files\""" >> &output_csv.; \
    fi; \
done";

* Import the resulting CSV into a SAS dataset;
proc import datafile="&output_csv."
    out=want
    dbms=csv
    replace;
    getnames=yes;
run;

* Display the dataset;
proc print data=want;
    title "List of Files in INPUT Directories Under RED Folders";
run;
