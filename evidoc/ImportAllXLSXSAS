%macro importAll(dir, physname);
    options nodate nonumber;
    /* Determine the last four digits from the file name */
    %let last4 = %substr(&physname, %length(&physname) - 7, 4);

    libname in_xlsx xlsx "&dir.&physname";

    /* Copy each sheet and rename to include the last four digits */
    proc datasets library=in_xlsx nolist;
        copy out=work; /* Using work as the temporary library */
        %let num = 1;
        %do %while(%sysfunc(exist(in_xlsx._DATA_&num)) eq 1);
            modify _DATA_&num (rename=(_DATA_&num=REDA_&last4._DATA_&num));
            %let num = %eval(&num + 1);
        %end;
    run;

    libname in_xlsx clear;
%mend importAll;

/* Example data step to create a list of files to process */
data test(keep=dir physname);
    filename thisdir "/path/to/excel/files";
    dir = "/path/to/excel/files";
    did=dopen("thisdir");
    numfiles=dnum(did);

    do i=1 to numfiles;
        physname=dread(did,i);
        if scan(physname, 2, '.') = "xlsx" then output;
    end;
    rc=dclose(did);
run;

/* Call the macro for each file */
data _null_;
    set test;
    call execute('%importAll(dir=' || strip(dir) || ', physname=' || strip(physname) || ');');
run;
