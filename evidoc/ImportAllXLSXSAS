%macro importSheetsQC3(file_path, last4);
    /* Import 'Summary' sheet */
    proc import datafile="&file_path" out=REDA&last4._Summary dbms=xlsx replace;
        sheet="Summary";
    run;

    /* Loop through sheets 301 to 320 */
    %do i=301 %to 320;
        /* Special case for sheet 310 */
        %if &i = 310 %then %do;
            /* Import with range C:G */
            proc import datafile="&file_path" out=work.temp dbms=xlsx replace;
                sheet="&i" range="C:G";
            run;
            /* Data cleaning: delete if all missing or C ends with ':' */
            data REDA&last4._&i;
                set work.temp;
                if cmiss(of _all_) or substr(C, length(C)) = ':' then delete;
            run;
        %end;
        %else %do;
            /* Import with range C:D for other sheets */
            proc import datafile="&file_path" out=work.temp dbms=xlsx replace;
                sheet="&i" range="C:D";
            run;
            /* Possibly further processing, creating final dataset */
            data REDA&last4._&i;
                set work.temp;
                /* Further processing or data cleaning if needed */
            run;
        %end;
    %end;

%mend importSheetsQC3;

%macro importAllSheets(directory);
    /* Step 1: Get the list of all xlsx files and extract a four-digit number from anywhere in the filename */
    filename _dir_ "&directory";
    data file_list(keep=filename last4);
        length filename $256. last4 $4.;
        dir_id = dopen('_dir_');
        if dir_id > 0 then do;
            file_num = dnum(dir_id);
            do i = 1 to file_num;
                filename = dread(dir_id, i);
                /* Check for xlsx extension */
                if lowcase(scan(filename, -1, '.')) = 'xlsx' then do;
                    /* Use a regular expression to find the first occurrence of a four-digit number in the filename */
                    if prxmatch("/(\d{4})/", filename) then do;
                        last4 = prxposn(prxparse("/(\d{4})/"), 1, filename);
                    end;
                    else last4 = "0000";
                    output;
                end;
            end;
        end;
        rc = dclose(dir_id);
    run;

    /* Step 2: Process each file with the %importSheetsDAQ3 macro */
    data _null_;
        set file_list;
        /* Construct the full path of the file */
        file_path = catx('/', "&directory", filename);
        /* Call the import macro with the full path and the four-digit number found in the filename */
        call execute(cats('%importSheetsQC3(', quote(trim(file_path)), ', ', last4, ')'));
    run;
%mend importAllSheets;

/* Invoke the master macro with the directory containing your XLSX files */
%importAllSheets(/path/to/your/xlsx/files);
