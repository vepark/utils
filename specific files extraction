# Define the main folders to search
$mainFolders = @("C:\Path\To\MainFolder1", "C:\Path\To\MainFolder2") # Main folder paths

# Define partial names of subfolders
$subFolderNames = @("SubFolderName1", "SubFolderName2") # Part of subfolder names

# Define the destination folder
$destinationFolder = "C:\Path\To\DestinationFolder"

# Define file criteria for two types of files
$fileCriteria1 = "*abcd*.pdf" # First file type criteria
$fileCriteria2 = "*efgh*.docx" # Second file type criteria

# Ensure the destination folder exists
if (-not (Test-Path -Path $destinationFolder)) {
    New-Item -ItemType Directory -Path $destinationFolder
}

# Function to search and copy files based on criteria
function SearchAndCopyFiles {
    param (
        [string]$path,
        [string]$fileCriteria
    )

    Get-ChildItem -Path $path -Filter $fileCriteria -Recurse -ErrorAction SilentlyContinue | ForEach-Object {
        try {
            Copy-Item -Path $_.FullName -Destination $destinationFolder -ErrorAction Stop
        } catch {
            Write-Warning "Failed to copy file: $($_.FullName). Error: $($_.Exception.Message)"
        }
    }
}

# Search and copy the files
foreach ($mainFolder in $mainFolders) {
    foreach ($subFolderName in $subFolderNames) {
        # Search for subfolders matching the partial name within each main folder
        $subFolders = Get-ChildItem -Path $mainFolder -Directory -Recurse -ErrorAction SilentlyContinue | 
                      Where-Object { $_.Name -like "*$subFolderName*" }

        foreach ($subFolder in $subFolders) {
            $path = $subFolder.FullName

            # Check if the subfolder exists
            if (Test-Path -Path $path) {
                SearchAndCopyFiles -path $path -fileCriteria $fileCriteria1
                SearchAndCopyFiles -path $path -fileCriteria $fileCriteria2
            }
        }
    }
}

Write-Host "File copy completed."
