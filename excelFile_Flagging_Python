import pandas as pd
import os

# Path to the Excel file
file_path = os.path.join(os.path.expanduser('~'), 'Downloads', 'ABCChanges.xlsx')

# Read the Excel file into a DataFrame
df = pd.read_excel(file_path)

# Function to check if values in a column change within a group
def flag_changes(group, column):
    return 1 if group[column].nunique() > 1 else 0

# Group by 'ID' and apply the function to 'Amount' and 'Accounts'
grouped = df.groupby('ID')
df['Amount Changed'] = grouped.apply(lambda x: flag_changes(x, 'Amount')).reset_index(level=0, drop=True)
df['Account Changed'] = grouped.apply(lambda x: flag_changes(x, 'Accounts')).reset_index(level=0, drop=True)

# Save the modified DataFrame back to an Excel file
df.to_excel(os.path.join(os.path.expanduser('~'), 'Downloads', 'ABCChanges_Analyzed.xlsx'), index=False)
