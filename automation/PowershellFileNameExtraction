#in SAS
%let basePath = C:\Path\To\DMS;
%let mainfolders = "12345678","87654321";  %* Example main folder identifiers;
%let subfolderpatterns = "1234","2345","3456";  %* Explicit subfolder names to match;

options xcmd;  %* Enable external command execution;

%let cmd = powershell.exe -File "C:\Path\To\YourScript.ps1" -basePath "&basePath" -mainfolders &mainfolders -subfolderpatterns &subfolderpatterns;
x &cmd;  %* Execute the PowerShell command;







param(
    [string]$basePath,               # Base path to the DMS
    [string[]]$mainfolders,          # Array of main folder names under basePath
    [string[]]$subfolderpatterns     # Explicit subfolder names to find
)

# Function to find all specified subfolders within the main folders
function Get-SpecifiedSubfolders {
    param(
        [string]$startFolder,
        [string[]]$subfolderNames
    )
    $foundSubfolders = @()
    foreach ($name in $subfolderNames) {
        $foundSubfolders += Get-ChildItem -Path $startFolder -Recurse -Directory |
                            Where-Object { $_.Name -eq $name } |
                            ForEach-Object { $_.FullName }
    }
    return $foundSubfolders
}

$results = @()

# Process each main folder under the base path
foreach ($folder in $mainfolders) {
    $fullMainFolderPath = Join-Path -Path $basePath -ChildPath $folder.Trim()

    # Find specified subfolders within the main folder
    $matchingSubfolders = Get-SpecifiedSubfolders -startFolder $fullMainFolderPath -subfolderNames $subfolderpatterns

    # Process each found subfolder
    foreach ($subfolder in $matchingSubfolders) {
        $files = Get-ChildItem -Path $subfolder -Recurse -File | Select-Object -ExpandProperty FullName

        # Create output object
        $output = [PSCustomObject]@{
            MainFolder   = $folder
            SubFolder    = $subfolder
            AllFileNames = ($files -join ",")  # Join all file names with commas
        }
        $results += $output
    }
}

# Export results to CSV
$results | Export-Csv -Path "C:\Path\To\output.csv" -NoTypeInformation
