param(
    [string]$DriveLetter,
    [string]$MainFolderNames,
    [string]$SubFolderPatterns,
    [string]$CsvOutputPath
)

# Hardcoded path component after the drive letter
$basePathSuffix = "\Your\Hardcoded\Path\After\DriveLetter"

# Construct the base path
$basePath = "${DriveLetter}:$basePathSuffix"

# Convert the comma-separated strings into arrays
$mainFoldersArray = $MainFolderNames -split ","
$subFoldersArray = $SubFolderPatterns -split ","

# Prepare an array to collect the results
$results = @()

foreach ($folderName in $mainFoldersArray) {
    $folderPath = Join-Path -Path $basePath -ChildPath $folderName.Trim()
    if (Test-Path $folderPath) {
        foreach ($subPattern in $subFoldersArray) {
            $subFolders = Get-ChildItem -Path $folderPath -Directory | Where-Object { $_.Name -like "*$subPattern*" }
            foreach ($subFolder in $subFolders) {
                # Process files within sub-folder as per your requirements
                $files = Get-ChildItem -Path $subFolder.FullName -File | Where-Object { $_.Name -like "*workbook*.xlsx" -or $_.Name -like "*evidence*.docx" }
                foreach ($file in $files) {
                    $results += [PSCustomObject]@{
                        MainFolder = $folderName
                        SubFolder = $subFolder.Name
                        FilePath = $file.FullName
                    }
                }
            }
        }
    }
}

# Export the results to CSV
$results | Export-Csv -Path $CsvOutputPath -NoTypeInformation -Encoding UTF8







Sub CallPowerShellAndImportData()
    Dim psScriptPath As String
    Dim csvOutputPath As String
    Dim shell As Object
    Dim command As String
    Dim driveLetter As String, mainFolders As String, subFolders As String

    ' Define the path to the PowerShell script
    psScriptPath = "\\SharedDrive\Path\To\YourScript.ps1" ' Update with the actual path

    ' Define the output path for the CSV file
    csvOutputPath = Environ("TEMP") & "\output.csv"

    ' Collect inputs from the user
    driveLetter = InputBox("Enter the drive letter (e.g., C, D, E):", "Drive Letter")
    mainFolders = InputBox("Enter main folder names (comma-separated):", "Main Folders")
    subFolders = InputBox("Enter sub-folder names (comma-separated):", "Sub Folders")

    ' Prepare the PowerShell command
    command = "powershell -ExecutionPolicy Bypass -File """ & psScriptPath & """ " & _
              """" & driveLetter & """ """ & mainFolders & """ """ & subFolders & """ """ & csvOutputPath & """"

    ' Create and run the command with waiting on return
    Set shell = CreateObject("WScript.Shell")
    shell.Run command, 0, True ' Here, True waits for the command to complete

    ' After PowerShell script completes, import the CSV data into a new worksheet
    ImportCsvData csvOutputPath
End Sub

Sub ImportCsvData(csvFilePath As String)
    Dim ws As Worksheet
    Set ws = ThisWorkbook.Sheets.Add
    ws.Name = "PowerShell Results"

    With ws.QueryTables.Add("TEXT;" & csvFilePath, ws.Range("A1"))
        .TextFileParseType = xlDelimited
        .TextFileCommaDelimiter = True
        .Refresh
    End With
End Sub
