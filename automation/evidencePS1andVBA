param(
    [string]$DriveLetter,
    [string]$MainFolderNames,
    [string]$SubFolderPatterns,
    [string]$CsvOutputPath
)

# Hardcoded path component after the drive letter
$basePathSuffix = "\Your\Hardcoded\Path\After\DriveLetter"

# Construct the base path
$basePath = "${DriveLetter}:$basePathSuffix"

# Convert the comma-separated strings into arrays
$mainFoldersArray = $MainFolderNames -split ","
$subFoldersArray = $SubFolderPatterns -split ","

# Prepare an array to collect the results
$results = @()

foreach ($folderName in $mainFoldersArray) {
    $folderPath = Join-Path -Path $basePath -ChildPath $folderName.Trim()
    if (Test-Path $folderPath) {
        foreach ($subPattern in $subFoldersArray) {
            $subFolders = Get-ChildItem -Path $folderPath -Directory | Where-Object { $_.Name -like "*$subPattern*" }
            foreach ($subFolder in $subFolders) {
                # Process files within sub-folder as per your requirements
                $files = Get-ChildItem -Path $subFolder.FullName -File | Where-Object { $_.Name -like "*workbook*.xlsx" -or $_.Name -like "*evidence*.docx" }
                foreach ($file in $files) {
                    $results += [PSCustomObject]@{
                        MainFolder = $folderName
                        SubFolder = $subFolder.Name
                        FilePath = $file.FullName
                    }
                }
            }
        }
    }
}

# Export the results to CSV
$results | Export-Csv -Path $CsvOutputPath -NoTypeInformation -Encoding UTF8







Sub CallPowerShellAndImportData()
    Dim psScriptPath As String
    Dim csvOutputPath As String
    Dim shell As Object
    Dim command As String
    Dim driveLetter As String, mainFolders As String, subFolders As String
    
    ' Define the path to the PowerShell script
    ' Update this path to where you've saved YourScript.ps1
    psScriptPath = "\\SharedDrive\Path\To\YourScript.ps1"  ' Example: "\\server\share\folder\YourScript.ps1" or "C:\folder\YourScript.ps1"
    
    ' Define the output path for the CSV file
    csvOutputPath = Environ("TEMP") & "\output.csv"
    
    ' Collect inputs from the user
    driveLetter = InputBox("Enter the drive letter (e.g., C, D, E):", "Drive Letter")
    mainFolders = InputBox("Enter main folder names (comma-separated):", "Main Folders")
    subFolders = InputBox("Enter sub-folder names (comma-separated):", "Sub Folders")
    
    ' Prepare the PowerShell command. Note how the psScriptPath variable is used here.
    command = "powershell -ExecutionPolicy Bypass -File """ & psScriptPath & """ " & _
              """" & driveLetter & """ """ & mainFolders & """ """ & subFolders & """ """ & csvOutputPath & """"
    
    ' Create and run the command with waiting on return
    Set shell = CreateObject("WScript.Shell")
    shell.Run command, 0, True
    
    ' Optionally, you might want to add a delay or check for the existence of the output file before proceeding
    ' This is a simple wait loop to give PowerShell time to finish and create the CSV file.
    Application.Wait Now + TimeValue("0:00:10")  ' Wait for 10 seconds; adjust as needed based on expected script runtime.
    
    ' Import the CSV data into a new worksheet
    ImportCsvData csvOutputPath
    
    ' Inform the user that the operation is complete
    MsgBox "All done! Results have been entered into the sheet.", vbInformation
End Sub
